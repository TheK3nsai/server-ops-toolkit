# fail2ban local jail configuration
# Install: sudo cp /home/kensai/ops/conf/fail2ban-local.conf /etc/fail2ban/jail.d/local.conf
# Then: sudo systemctl restart fail2ban

[DEFAULT]
# Ban duration (default was 10m, increased for better protection)
bantime  = 1h

# Time window for counting failures
findtime  = 10m

# Max failures before ban
maxretry = 5

# Ignore local/trusted IPs (add your admin IPs here)
ignoreip = 127.0.0.1/8 ::1
# ignoreip = 127.0.0.1/8 ::1 YOUR.ADMIN.IP.HERE

# Email notifications (uncomment and configure if desired)
# destemail = admin@example.com
# sender = fail2ban@example.com
# action = %(action_mwl)s

# =============================================================================
# SSH Protection - ENABLED
# =============================================================================
[sshd]
enabled = true
port    = ssh
logpath = %(sshd_log)s
backend = %(sshd_backend)s
maxretry = 5
bantime = 1h

# Aggressive mode for repeat offenders
[sshd-aggressive]
enabled = true
port    = ssh
logpath = %(sshd_log)s
backend = %(sshd_backend)s
maxretry = 3
bantime = 24h
findtime = 1h

# =============================================================================
# Recidive - Ban repeat offenders for longer
# =============================================================================
[recidive]
enabled  = true
logpath  = /var/log/fail2ban.log
banaction = %(banaction_allports)s
bantime  = 1w
findtime = 1d
maxretry = 5

# =============================================================================
# Web Server Protection (if running nginx/apache directly, not in Docker)
# Uncomment if applicable - Docker containers have their own logs
# =============================================================================

# [nginx-http-auth]
# enabled = true
# port    = http,https
# logpath = /var/log/nginx/error.log
# maxretry = 5

# [nginx-botsearch]
# enabled = true
# port    = http,https
# logpath = /var/log/nginx/access.log
# maxretry = 2

# =============================================================================
# Traefik Protection (if logs are accessible)
# =============================================================================
# Note: Traefik in Docker logs to container, not host filesystem by default
# Configure Traefik to log to a host-mounted volume first

# [traefik-auth]
# enabled  = false
# port     = http,https
# logpath  = /path/to/traefik/access.log
# maxretry = 5
